def p(n,e=lambda e:[x for x in zip(*e)if 8in x]):i=[x for x in {}.fromkeys(sum(n,[]))if x%8];n=e(e(n));l=-~len(n);e=[[0]+[8]*~-l+[0]];n=e+[[8,*n,8]for n in n]+e;return[[n and i[(x:=[r,h,l-h,l-r]).index(e:=min(x))]*(x.count(e)<2)or n for h,n in enumerate(n)]for r,n in enumerate(n)]
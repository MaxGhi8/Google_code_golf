p=lambda g,K=311:-K*g or p([[a or(b==(s:=[*{*sum(g,[])}-{0,8}])[K%8<4])*s[K%8>3]for a,b in zip(r,r[1:]+[0])]for*r,in zip(*g[::-1])],K-1)
def p(z):*d,z,h,w,o=max((3>len({*(r:=sum(m:=[r[n:n+o]for r in z[t:t+t]],[]))}),r.count(r[0]),m,t,o,min({*r},key=r.count))for t in range(len(z))for n in range(len(z[0]))for t in range(2,len(z)-t)for o in range(2,len(z[0])-n));return[[[({*r}-{o}).pop(),o][o in d+r]for*d,in zip(*z)]for r in z]
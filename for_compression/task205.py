def p(g):*_,g,h,w,k=max((3>len({*(d:=sum(m:=[r[b:b+y]for r in g[a:a+x]],[]))}),d.count(d[0]),m,x,y,min({*d},key=d.count))for a in range(len(g))for b in range(len(g[0]))for x in range(2,len(g)-a)for y in range(2,len(g[0])-b));return[[[({*r}-{k}).pop(),k][k in c+r]for*c,in zip(*g)]for r in g]
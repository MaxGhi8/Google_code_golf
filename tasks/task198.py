p=lambda g,k=43:-k*g or p([[x*(x!=3)or(v==4)+3for x,v in zip(r,[0]+r)]for*r,in zip(*[[v or((r+c).count(max(g[5]))>12)*4for*c,v in zip(*g,r)]for r in g[::-1]])],k-1)
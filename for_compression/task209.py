def p(g):C=lambda g:g*any(g[0])or C([*zip(*filter(any,g))]);x,y=zip(*((x,y)for y,r in enumerate(g)for x,c in enumerate(r)if c==4));M=[r[x[0]:x[3]+1]for r in g[y[0]:y[3]+1]];P=C([[v*(j<x[0]or j>x[3]or i<y[0]or i>y[3])for j,v in enumerate(r)]for i,r in enumerate(g)]);return max((sum(map(lambda x,y:0<x==y,sum(M,[]),sum(m:=[[4*(v==4)or([[*r]+[0]*99for r in P]+[[0]*99]*99)[(i-I)//s][(j-J)//s]for j,v in enumerate(a)]for i,a in enumerate(M)],[]))),-s,m)for s in[*range(12)][1:]for I in range(12)for J in range(12))[2]
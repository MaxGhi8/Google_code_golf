p=lambda d,t=3,l=[0]*9:-t*d or p([[[a,5-5*(c==1>d),1,l:=r][(b>4)+(b>0)]for a,b,c,d in zip(r,[0]+r,l,[0]*2+r)]for*r,in zip(*d[::-1])],t-1)
def p(u,E=enumerate):
 def p(u):
  if u in e:r[u]=e.pop(u);x,y=u;[p((x+A%3-1,y+A//3-1))for A in range(9)]
 e,t,*o={(p,m):n for p,u in E(u)for m,n in E(u)if n},{},
 while e:o+=[r:={}];p(min(e))
 for A in 2,3:
  for r in o+o:
   if A in(s:={*r.values()}):f,m=min(u for u in r if r[u]==A)
   if{A}<s:V,=s-{A};t[A]=t.get(A,0)or[(u-f,(A*2-5)*(p-m))for u,p in r if r[u,p]==V]
   if t.get(A,0)and{A}==s:[u[f+r].__setitem__(m+n,V)for r,n in t[A]]
 return u
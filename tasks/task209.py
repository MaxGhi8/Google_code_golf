def p(g,E=enumerate,R=range):C=lambda g:g*any(g[0])or C([*zip(*filter(any,g))]);x,y=zip(*((x,y)for y,r in E(g)for x,c in E(r)if c==4));M=[r[x[0]:x[3]+1]for r in g[y[0]:y[3]+1]];P=C([[v*(j<x[0]or j>x[3]or i<y[0]or i>y[3])for j,v in E(r)]for i,r in E(g)]);return max((sum(map(lambda x,y:0<x==y,sum(M,[]),sum(m:=[[4*(M[i][j]==4)or([[*r]+[0]*99for r in P]+[[0]*99]*99)[(i-I)//s][(j-J)//s]for j in R(len(M[0]))]for i in R(len(M))],[]))),-s,m)for s in R(1,5)for I in R(12)for J in R(12))[2]
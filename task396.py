def p(g,R=range):m,n=len(g),len(g[0]);return max((sum(w:=sum((r[1:-1]for r in t[1:-1]),[])),[[v and max(w)for v in r]for r in t])for a in R(m)for b in R(n)for k in R(3,-~m-a)for h in R(3,-~n-b)if all((t:=[r[b:b+h]for r in g[a:a+k]])[0]+t[-1]+[r[i]for r in t for i in(0,-1)]))[1]
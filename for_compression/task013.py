def p(r,e=0):*r,=map(list,zip(*r));d=len(r[0]);(i,g,b),(u,l,t),*m=sorted((l%d,l//d,e)for l,e in enumerate(sum(r,[]))if e);g*l in{0,(len(r)-1)**2}and[e.__setitem__(l,[b,t][(l-i)//(u-i)%2])for e in r for l in range(i,d,u-i)];return e and r or p(r,1)
